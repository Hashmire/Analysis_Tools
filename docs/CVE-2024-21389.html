
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <style>
            .bg-pivot {
                --bs-bg-opacity: 1;
                background-color: rgb(181, 90, 232) !important;
            }
            .tab {
                overflow: hidden;
                border: 1px solid #ccc;
                background-color: #f1f1f1;
            }
            .tab button {
                background-color: inherit;
                float: left;
                border: none;
                outline: none;
                cursor: pointer;
                padding: 14px 16px;
                transition: 0.3s;
            }
            .tab button:hover {
                background-color: #ddd;
            }
            .tab button.active {
                background-color: #ccc;
            }
            .tabcontent {
                display: none;
                margin-left: 10px;
                border: 1px solid #ccc;
                border-top: none;
            }
            table.dataframe {
                table-layout: fixed;
                width: 100%;
            }
            table.dataframe td:first-child {
                width: 20%;
            }
            table.dataframe td:last-child {
                width: 80%;
            }
            /* Fix for the table row selection styling */
            .table-active,
            .table-active > td,
            .table-active > th {
                background-color: rgba(0, 123, 255, 0.35) !important;  /* Clearly visible blue */
            }
            .table-hover tbody tr:hover:not(.table-active) {
                background-color: rgba(0, 0, 0, 0.075) !important;  /* Light gray for hover */
            }
            /* Ensure selected trumps hover */
            .table-hover tbody tr.table-active:hover {
                background-color: rgba(0, 123, 255, 0.45) !important;  /* Slightly darker blue when hovering selected row */
            }
            /* Add pointer cursor to rows that can be selected */
            .cpe-row {
                cursor: pointer;
            }
        </style>
    </head>
    <body>
    
    <script>
    // Track selected rows per table
    const tableSelections = new Map(); // Map<tableId, Set<cpeBase>>
    const consolidatedJsons = new Map(); // Map<tableId, json>
    
    // Add CSS for better row selection visibility
    const style = document.createElement('style');
    style.textContent = `
        .table-active {
            background-color: rgba(0, 123, 255, 0.35) !important;
            font-weight: bold;
            border-left: 3px solid #007bff;
        }
        .json-container {
            transition: all 0.3s ease-in-out;
        }
        .btn-success {
            transition: background-color 0.3s ease;
        }
    `;
    document.head.appendChild(style);
    
    // Function to toggle row collapse state
    function toggleRowCollapse(tableIndex) {
        try {
            const rowDataTable = document.getElementById(`rowDataTable_${tableIndex}`);
            const matchesTable = document.getElementById(`matchesTable_${tableIndex}`);
            const jsonContainer = document.querySelector(`.consolidated-json-container[data-index="${tableIndex}"]`);
            const collapseButton = document.getElementById(`collapseRowButton_${tableIndex}`);
            const tableId = `matchesTable_${tableIndex}`; 
            
            // Define isCollapsed variable outside the if block
            let isCollapsed = false;
            
            if (rowDataTable && matchesTable) {
                // Toggle visibility for tables
                isCollapsed = rowDataTable.classList.toggle('d-none');
                matchesTable.classList.toggle('d-none');
                
                // Always ensure the JSON container is in the right place
                // regardless of collapsed state
                if (jsonContainer && collapseButton) {
                    // Get the parent of the collapse button
                    const buttonParent = collapseButton.parentNode;
                    
                    // Always move the JSON container to be adjacent to the button
                    buttonParent.parentNode.insertBefore(jsonContainer, buttonParent.nextSibling);
                    
                    // Add some spacing for better visual separation
                    jsonContainer.classList.add('mt-2');
                    
                    // IMPORTANT: Update the consolidated JSON button to maintain selection count
                    const selectedRows = tableSelections.get(tableId);
                    const selectionCount = selectedRows ? selectedRows.size : 0;
                    
                    // Find the consolidated JSON button
                    const showButton = document.getElementById(`showConsolidatedJson_${tableId}`);
                    const altShowButton = document.getElementById(`showConsolidatedJson_matchesTable_${tableIndex}`);
                    const buttonToUpdate = showButton || altShowButton;
                    
                    // Update the button text to maintain selection count
                    if (buttonToUpdate) {
                        // Check if display is visible
                        const display = document.getElementById(`consolidatedJsonDisplay_${tableId}`);
                        const isVisible = display && display.style.display !== 'none';
                        
                        // ADDED: Make sure we're seeing consistent behavior between the display and button
                        if (isVisible && display.style.display !== 'block') {
                            display.style.display = 'block';
                        }
                        
                        if (selectionCount > 0) {
                            buttonToUpdate.textContent = isVisible 
                                ? `Hide Consolidated JSON (${selectionCount} selected)` 
                                : `Show Consolidated JSON (${selectionCount} selected)`;
                        } else {
                            buttonToUpdate.textContent = isVisible 
                                ? `Hide Consolidated JSON` 
                                : `Show Consolidated JSON`;
                        }
                        
                        // ADDED: Ensure button styling matches display state
                        if (isVisible) {
                            buttonToUpdate.classList.remove('btn-primary');
                            buttonToUpdate.classList.add('btn-success');
                        } else {
                            buttonToUpdate.classList.remove('btn-success');
                            buttonToUpdate.classList.add('btn-primary');
                        }
                    }
                    
                    // Also update the display content if it's visible
                    updateJsonDisplayIfVisible(tableId);
                }
                
                // Update button text
                if (collapseButton) {
                    collapseButton.textContent = isCollapsed ? 'Expand Row (Completed)' : 'Collapse Row (Mark Complete)';
                    collapseButton.classList.toggle('btn-success', isCollapsed);
                    collapseButton.classList.toggle('btn-secondary', !isCollapsed);
                }
            }
            // Define variables before using them in console.debug
            const selectedRows = tableSelections.get(tableId) || new Set();
            const selectionCount = selectedRows.size;
            
            // Get display visibility state
            const display = document.getElementById(`consolidatedJsonDisplay_${tableId}`);
            const isVisible = display && display.style.display !== 'none';
            
            console.debug(`Table ${tableId} collapsed: ${isCollapsed}, Selection count: ${selectionCount}, JSON visible: ${isVisible}`);
            // Update the completion tracker
            updateCompletionTracker();
            // Update the export all configurations button text
            updateExportAllButton();
            
            // NEW LINE: Preserve JSON display state
            preserveJsonDisplayState(tableIndex);
        } catch(e) {
            console.error(`Error in toggleRowCollapse for tableIndex ${tableIndex}:`, e);
        }
    }
    
    // Add event listeners when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', function() {
        try {
            // Find all matchesTables (there may be multiple) - MOVED UP FROM BELOW
            const tables = document.querySelectorAll('table[id^="matchesTable"]');
            
            // Add a master "Export All Configurations" button at the top of cveListCPESuggester
            const cveListCPESuggester = document.getElementById('cveListCPESuggester');
            if (cveListCPESuggester) {
                // Create the Export All container at the beginning
                const allContainer = document.createElement('div');
                allContainer.classList.add('all-configurations-container', 'mt-3', 'mb-5');
                allContainer.id = 'allConfigurationsContainer';
                allContainer.innerHTML = `
                    <!-- NEW: Add configuration summary above the button -->
                    <div id="configurationSummary" class="text-center mb-2" style="font-weight: 500;"></div>
                    <div class="d-grid gap-2 col-12 mx-auto">
                        <button id="exportAllConfigurations" class="btn btn-danger">Show All Configurations</button>
                    </div>
                    <div id="allConfigurationsDisplay" class="mt-3" style="display: none;">
                        <h4>Complete Configuration JSON</h4>
                        <p class="text-muted">This combines all selected CPEs from all tables, with each table creating its own configuration node.</p>
                        <pre id="allConfigurationsContent" style="max-height: 600px; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 5px;"></pre>
                    </div>
                `;
                
                // Insert at the beginning of cveListCPESuggester
                if (cveListCPESuggester.firstChild) {
                    cveListCPESuggester.insertBefore(allContainer, cveListCPESuggester.firstChild.nextSibling);
                } else {
                    cveListCPESuggester.appendChild(allContainer);
                }
                
                // Add click handler to the Export All button
                document.getElementById('exportAllConfigurations').addEventListener('click', function() {
                    const display = document.getElementById('allConfigurationsDisplay');
                    const content = document.getElementById('allConfigurationsContent');
                    
                    if (display && content) {
                        // Create master JSON with configurations from all tables
                        const masterJson = generateAllConfigurationsJson();
                        
                        if (!masterJson || !masterJson.configurations || masterJson.configurations.length === 0) {
                            content.textContent = 'No CPEs selected in any table. Please select at least one CPE row.';
                        } else {
                            content.textContent = JSON.stringify(masterJson, null, 2);
                        }
                        
                        // Toggle display
                        display.style.display = display.style.display === 'none' ? 'block' : 'none';
                        
                        // Update the button text to reflect current state (without configuration details)
                        this.textContent = display.style.display === 'none' ? 'Show All Configurations' : 'Hide All Configurations';
                    }
                });
                
                // Add this to the DOMContentLoaded event handler after creating the export all container
                // Create a completion tracker container only if allContainer exists
                const completionTrackerContainer = document.createElement('div');
                completionTrackerContainer.classList.add('completion-tracker-container', 'mt-3', 'mb-3', 'p-3', 'border', 'rounded');
                completionTrackerContainer.id = 'completionTrackerContainer';
                completionTrackerContainer.innerHTML = `
                    <h4>Completion Progress</h4>
                    <div class="progress mb-2">
                        <div id="completionProgressBar" class="progress-bar bg-success" role="progressbar" style="width: 0%" 
                             aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</</div>
                    </div>
                    <div class="d-flex justify-content-between">
                        <span id="completedRowsCount">0 rows completed</span>
                        <span id="totalRowsCount">${tables.length} total rows</span>
                    </div>
                `;

                // Insert right after the export all container, using the allContainer we just created
                allContainer.parentNode.insertBefore(completionTrackerContainer, allContainer.nextSibling);

                // Initialize the completion tracker
                updateCompletionTracker();
            }

            // Rest of your code remains the same...
            tables.forEach((table, tableIndex) => {
                const tableId = table.id;
                
                // Initialize selections for this table
                tableSelections.set(tableId, new Set());
                
                // Add click handlers to all CPE rows in this table
                const rows = table.querySelectorAll('.cpe-row');
                rows.forEach(function(row) {
                    row.addEventListener('click', function(event) {
                        try {
                            // Get data attributes
                            const cpeBase = this.getAttribute('data-cpe-base');
                            
                            // Get selections for this table
                            const selectedRows = tableSelections.get(tableId);
                            
                            // Check if this row is already active (selected)
                            const isAlreadyActive = this.classList.contains('table-active');
                            
                            // Handle row selection based on whether Ctrl/Cmd key is pressed
                            if (event.ctrlKey || event.metaKey) {
                                // Toggle this row only, without affecting other selections
                                if (isAlreadyActive) {
                                    this.classList.remove('table-active');
                                    selectedRows.delete(cpeBase);
                                } else {
                                    this.classList.add('table-active');
                                    selectedRows.add(cpeBase);
                                }
                            } else {
                                // No modifier key: toggle this row only if it's the only one selected
                                if (isAlreadyActive && selectedRows.size === 1 && selectedRows.has(cpeBase)) {
                                    // If only this row is selected, toggle it off
                                    this.classList.remove('table-active');
                                    selectedRows.delete(cpeBase);
                                } else {
                                    // If clicking a new row or multiple rows are selected, just select this one
                                    if (!isAlreadyActive) {
                                        // Clear other selections only if not using modifier key
                                        rows.forEach(r => {
                                            if (r !== this && r.classList.contains('table-active')) {
                                                r.classList.remove('table-active');
                                            }
                                        });
                                        
                                        // Select this row
                                        this.classList.add('table-active');
                                        selectedRows.clear();
                                        selectedRows.add(cpeBase);
                                    }
                                }
                            }
                            
                            // Update consolidated JSON display for this table
                            updateConsolidatedJson(tableId);
                            
                            // Ensure the master export button is properly displayed
                            updateExportAllButton();
                        } catch(e) {
                            console.error(`Error handling row click in table ${tableId}:`, e);
                            
                            // NEW: Update UI to show error and return to previous state
                            // This ensures the UI isn't left in an inconsistent state
                            alert(`Error processing selection. The UI has been restored to its previous state.`);
                            
                            // Force refresh selections from the current DOM state
                            const currentSelections = new Set();
                            rows.forEach(r => {
                                if (r.classList.contains('table-active')) {
                                    const cpeBase = r.getAttribute('data-cpe-base');
                                    if (cpeBase) {
                                        currentSelections.add(cpeBase);
                                    }
                                }
                            });
                            
                            // Reset the selections to match the DOM
                            tableSelections.set(tableId, currentSelections);
                            
                            // Update the button states to match the current DOM
                            updateConsolidatedJson(tableId);
                            updateExportAllButton();
                        }
                    });
                });
                
                // Add a container for consolidated JSON right after this table
                const container = document.createElement('div');
                container.classList.add('consolidated-json-container', 'mt-3', 'mb-4', 'json-container');
                container.setAttribute('data-index', tableIndex);
                container.innerHTML = `
                    <div id="consolidatedJsonDisplay_${tableId}" class="mt-3" style="display: none;">
                        <h4>Consolidated Configuration JSON</h4>
                        <pre id="consolidatedJsonContent_${tableId}" style="max-height: 400px; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 5px;"></pre>
                    </div>
                `;
                
                // Place the container directly after the table
                table.parentNode.insertBefore(container, table.nextSibling);
                
                // Create the consolidated JSON button and place it next to the collapse button
                const jsonButton = document.createElement('button');
                jsonButton.id = `showConsolidatedJson_${tableId}`;
                jsonButton.className = 'btn btn-primary';
                jsonButton.textContent = 'Show Consolidated JSON';

                // Find the button container and add the JSON button
                const collapseButtonContainer = document.getElementById(`buttonContainer_${tableIndex}`);
                if (collapseButtonContainer) {
                    collapseButtonContainer.appendChild(jsonButton);
                }

                // Add click handler to the button - find it first since it's already in the DOM
                const showButton = document.getElementById(`showConsolidatedJson_${tableId}`);
                if (showButton) {
                    showButton.addEventListener('click', function() {
                        try {
                            const display = document.getElementById(`consolidatedJsonDisplay_${tableId}`);
                            
                            if (display) {
                                // Check if the corresponding table is collapsed
                                const matchesTable = document.getElementById(tableId);
                                const tableIndex = tableId.split('_')[1];
                                const rowDataTable = document.getElementById(`rowDataTable_${tableIndex}`);
                                const isTableCollapsed = matchesTable.classList.contains('d-none');
                                const jsonContainer = document.querySelector(`.consolidated-json-container[data-index="${tableIndex}"]`);
                                const collapseButton = document.getElementById(`collapseRowButton_${tableIndex}`);
                                
                                // Toggle display
                                const isVisible = display.style.display === 'none' ? false : true;
                                display.style.display = isVisible ? 'none' : 'block';
                                
                                // ADDED: Always ensure the JSON container is in the right place when showing
                                if (!isVisible && jsonContainer && collapseButton) {
                                    // Get the parent of the collapse button
                                    const buttonParent = collapseButton.parentNode;
                                    
                                    // Always move the JSON container to be adjacent to the button
                                    buttonParent.parentNode.insertBefore(jsonContainer, buttonParent.nextSibling);
                                    
                                    // Add some spacing for better visual separation
                                    jsonContainer.classList.add('mt-2');
                                }
                                
                                // Get selection count for button text
                                const selectedRows = tableSelections.get(tableId);
                                const selectionCount = selectedRows ? selectedRows.size : 0;
                                
                                // Update button text with count and state
                                if (selectionCount > 0) {
                                    this.textContent = isVisible ? 
                                        `Show Consolidated JSON (${selectionCount} selected)` : 
                                        `Hide Consolidated JSON (${selectionCount} selected)`;
                                } else {
                                    this.textContent = isVisible ? 'Show Consolidated JSON' : 'Hide Consolidated JSON';
                                }
                                
                                // Update content when showing
                                if (!isVisible) {
                                    updateJsonDisplayIfVisible(tableId);
                                }
                                
                                // Update button styling
                                if (!isVisible) {
                                    this.classList.remove('btn-primary');
                                    this.classList.add('btn-success');
                                } else {
                                    this.classList.remove('btn-success');
                                    this.classList.add('btn-primary');
                                }
                            }
                        } catch(e) {
                            console.error(`Error toggling JSON display for table ${tableId}:`, e);
                        }
                    });
                }
            });
            
            // Initial update of Export All button visibility
            updateExportAllButton();
            
        } catch(e) {
            console.error("Error in DOMContentLoaded event handler:", e);
        }
    });
    
    // Update JSON display if it's currently visible
    function updateJsonDisplayIfVisible(tableId) {
        try {
            const display = document.getElementById(`consolidatedJsonDisplay_${tableId}`);
            const content = document.getElementById(`consolidatedJsonContent_${tableId}`);
            
            // Only update if the display is visible
            if (display && content && display.style.display !== 'none') {
                const selectedRows = tableSelections.get(tableId);
                
                if (!selectedRows || selectedRows.size === 0) {
                    content.textContent = 'No rows selected. Please select at least one row.';
                } else {
                    // Get the consolidated JSON for this table
                    const json = consolidatedJsons.get(tableId);
                    content.textContent = JSON.stringify(json, null, 2);
                }
            }
        } catch(e) {
            console.error(`Error updating JSON display for table ${tableId}:`, e);
        }
    }
    
    // Parse a CPE string to extract vendor and product information
    function parseCpeString(cpeString) {
        try {
            // For CPE 2.3 formatted strings (cpe:2.3:part:vendor:product:version:...)
            const parts = cpeString.split(':');
            if (parts.length >= 5) {
                return {
                    vendor: parts[3].toLowerCase(),
                    product: parts[4].toLowerCase()
                };
            }
            return { vendor: null, product: null };
        } catch (e) {
            console.warn("Error parsing CPE string:", e);
            return { vendor: null, product: null };
        }
    }
    
    // Update consolidated JSON function with enhanced version handling and statistics
    function updateConsolidatedJson(tableId) {
        try {
            const selectedRows = tableSelections.get(tableId);
            
            if (!selectedRows || selectedRows.size === 0) {
                consolidatedJsons.set(tableId, null);
                
                // Update the button to reflect no selections
                const showButton = document.getElementById(`showConsolidatedJson_${tableId}`);
                if (showButton) {
                    showButton.textContent = "Show Consolidated JSON";
                    showButton.disabled = true;
                    showButton.classList.remove('btn-success');
                    showButton.classList.add('btn-primary');
                }
                
                // Always update the JSON display if it's visible
                updateJsonDisplayIfVisible(tableId);
                return;
            } else {
                // Re-enable the button if we have selections
                const showButton = document.getElementById(`showConsolidatedJson_${tableId}`);
                if (showButton) {
                    showButton.disabled = false;
                    showButton.classList.remove('disabled');
                    
                    // If display is visible, update button to show success state
                    const display = document.getElementById(`consolidatedJsonDisplay_${tableId}`);
                    if (display && display.style.display !== 'none') {
                        showButton.classList.remove('btn-primary');
                        showButton.classList.add('btn-success');
                    }
                }
            }
            
            // Extract the table index from tableId (e.g. "matchesTable_0" -> "0")
            const tableIndex = tableId.split('_')[1];
            
            // Look specifically for the corresponding rowDataTable with the same index
            const rowDataTableId = `rowDataTable_${tableIndex}`;
            const rowDataTable = document.getElementById(rowDataTableId);
            
            let dataSource = "Unknown";
            let sourceId = "Unknown";
            let sourceRole = "Unknown";
            let rawPlatformData = null;
            let rawConfigData = null; // New: For storing NVD configuration data
            
            if (rowDataTable) {
                const rows = rowDataTable.getElementsByTagName('tr');
                
                // Scan through all rows in this specific table
                for (let i = 0; i < rows.length; i++) {
                    const cells = rows[i].getElementsByTagName('td');
                    if (cells.length >= 2) {
                        const labelCell = cells[0];
                        const valueCell = cells[1];
                        
                        if (labelCell.textContent.includes("Data Source")) {
                            dataSource = valueCell.textContent.trim();
                        }
                        else if (labelCell.textContent.includes("Source ID")) {
                            // Extract just the UUID part if there's more text
                            const sourceIdText = valueCell.textContent.trim();
                            const uuidMatch = sourceIdText.match(/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/i);
                            if (uuidMatch) {
                                sourceId = uuidMatch[0];
                            } else {
                                sourceId = sourceIdText;
                            }
                        }
                        else if (labelCell.textContent.includes("Source Role")) {
                            sourceRole = valueCell.textContent.trim();
                        }
                    }
                }

                // Find the corresponding CPE query container
                const matchesTable = document.getElementById(`matchesTable_${tableIndex}`);
                if (matchesTable) {
                    // Look for the parent container of the table
                    const cpeQueryContainer = matchesTable.parentElement;
                    
                    // First check for complete configuration data (for NVD API data)
                    if (cpeQueryContainer && cpeQueryContainer.hasAttribute('data-raw-config')) {
                        try {
                            rawConfigData = JSON.parse(cpeQueryContainer.getAttribute('data-raw-config'));
                            console.debug("Successfully loaded raw configuration data");
                        } catch (e) {
                            console.warn(`Failed to parse configuration data: ${e}`);
                        }
                    }
                    
                    // Then check for platform data (for version information)
                    if (cpeQueryContainer && cpeQueryContainer.hasAttribute('data-raw-platform')) {
                        try {
                            rawPlatformData = JSON.parse(cpeQueryContainer.getAttribute('data-raw-platform'));
                            console.debug("Successfully loaded platform data");
                        } catch (e) {
                            console.warn(`Failed to parse platform data: ${e}`);
                        }
                    }
                }
            }
            
            // Create configurations structure
            let json = {
                "configurations": [
                    {
                        "operator": "OR",
                        "negate": false,
                        "cpeMatch": [],
                        "generatedFromSource": {
                            "dataSource": dataSource,
                            "sourceId": sourceId,
                            "sourceRole": sourceRole
                        }
                    }
                ]
            };
            
            // If we have raw config data from NVD, use that instead of building our own
            if (rawPlatformData && dataSource === "NVDAPI" && rawPlatformData.hasEmbeddedConfig) {
                // We have a reference to configuration data, but need to get it from the raw-config attribute
                const cpeQueryContainer = matchesTable.parentElement;
                
                if (cpeQueryContainer && cpeQueryContainer.hasAttribute('data-raw-config')) {
                    try {
                        const rawConfigData = JSON.parse(cpeQueryContainer.getAttribute('data-raw-config'));
                        
                        // Clone the raw config to avoid modifying the original
                        const configCopy = JSON.parse(JSON.stringify(rawConfigData));
                        
                        // Add our source information to the config
                        configCopy.generatedFromSource = json.configurations[0].generatedFromSource;
                        
                        // Filter to only include selected CPEs if applicable
                        if (selectedRows && selectedRows.size > 0 && configCopy.nodes) {
                            configCopy.nodes = configCopy.nodes.filter(node => {
                                if (node.cpeMatch) {
                                    node.cpeMatch = node.cpeMatch.filter(match => 
                                        selectedRows.has(match.criteria));
                                    return node.cpeMatch.length > 0;
                                }
                                return false;
                            });
                        }
                        
                        // Store version statistics in the JSON for display
                        const versionCount = getTotalCPEMatches(configCopy);
                        configCopy.versionStats = {
                            totalVersions: versionCount,
                            selectedCPEs: selectedRows.size
                        };
                        
                        json.configurations[0] = configCopy;
                    } catch (e) {
                        console.warn(`Failed to process configuration data: ${e}`);
                        // Fall back to basic processing
                        processBasicVersionData(selectedRows, rawPlatformData, json);
                    }
                }
            } else if (rawConfigData && dataSource === "NVDAPI") {
                // This is the existing code for when config data is in a separate attribute
                // Start with the raw config but preserve our source information
                const sourceInfo = json.configurations[0].generatedFromSource;
                
                // Clone the raw config to avoid modifying the original
                const configCopy = JSON.parse(JSON.stringify(rawConfigData));
                
                // Add our source information to the config
                if (typeof configCopy === 'object') {
                    configCopy.generatedFromSource = sourceInfo;
                    
                    // Filter to only include selected CPEs if applicable
                    if (selectedRows && selectedRows.size > 0 && configCopy.nodes) {
                        // Filter nodes to only include those with selected CPE matches
                        configCopy.nodes = configCopy.nodes.filter(node => {
                            if (node.cpeMatch) {
                                // Keep only the CPE matches that are selected
                                node.cpeMatch = node.cpeMatch.filter(match => 
                                    selectedRows.has(match.criteria));
                                
                                // Keep the node if it still has CPE matches
                                return node.cpeMatch.length > 0;
                            }
                            return false;
                        });
                    }
                    
                    json.configurations[0] = configCopy;
                }
            } else {
                // No raw config, build our own using version data
                processBasicVersionData(selectedRows, rawPlatformData, json);
            }
            
            // Store the consolidated JSON for this table
            consolidatedJsons.set(tableId, json);
            
            // Calculate detailed statistics about cpeMatch objects
            const selectionCount = selectedRows.size;
            let totalMatches = 0;
            let rangeMatches = 0;
            let exactMatches = 0;
            
            // Function to check if a cpeMatch is a range match
            function isRangeMatch(match) {
                return match.hasOwnProperty('versionStartIncluding') || 
                       match.hasOwnProperty('versionStartExcluding') || 
                       match.hasOwnProperty('versionEndIncluding') || 
                       match.hasOwnProperty('versionEndExcluding');
            }
            
            // Process statistics based on configuration structure
            if (json.configurations[0].cpeMatch && json.configurations[0].cpeMatch.length > 0) {
                totalMatches = json.configurations[0].cpeMatch.length;
                
                // Count range vs exact matches
                json.configurations[0].cpeMatch.forEach(match => {
                    if (isRangeMatch(match)) {
                        rangeMatches++;
                    } else {
                        exactMatches++;
                    }
                });
            } else if (json.configurations[0].nodes) {
                json.configurations[0].nodes.forEach(node => {
                    if (node.cpeMatch) {
                        totalMatches += node.cpeMatch.length;
                        
                        // Count range vs exact matches in this node
                        node.cpeMatch.forEach(match => {
                            if (isRangeMatch(match)) {
                                rangeMatches++;
                            } else {
                                exactMatches++;
                            }
                        });
                    }
                });
            }
            
            // Store the statistics in the JSON for future reference
            json.configurations[0].matchStats = {
                totalMatches: totalMatches,
                rangeMatches: rangeMatches,
                exactMatches: exactMatches,
                selectedCriteria: selectionCount  // Changed from selectedCPEs to selectedCriteria
            };
            
            // Format the detailed statistics for display
            const statsStr = `${selectionCount} Criteria, ${totalMatches} versions (${exactMatches} exact, ${rangeMatches} ranges)`;
            
            const showButton = document.getElementById(`showConsolidatedJson_${tableId}`);
            const altShowButton = document.getElementById(`showConsolidatedJson_matchesTable_${tableIndex}`);
            const buttonToUpdate = showButton || altShowButton;

            if (buttonToUpdate) {
                // Add selection counter and version stats to button text
                const display = document.getElementById(`consolidatedJsonDisplay_${tableId}`);
                if (display && display.style.display !== 'none') {
                    buttonToUpdate.textContent = `Hide Consolidated JSON (${statsStr})`;
                    buttonToUpdate.classList.remove('btn-primary');
                    buttonToUpdate.classList.add('btn-success');
                } else {
                    buttonToUpdate.textContent = `Show Consolidated JSON (${statsStr})`;
                    buttonToUpdate.classList.remove('btn-success');
                    buttonToUpdate.classList.add('btn-primary');
                }
            }
            
            // Always update the JSON display if it's visible
            updateJsonDisplayIfVisible(tableId);
            updateAllConfigurationsDisplay();
            
        } catch(e) {
            console.error(`Error updating consolidated JSON for table ${tableId}:`, e);
        }
    }
    
    function updateExportAllButton() {
        try {
            // Check if any tables have selected rows
            let hasSelections = false;
            let totalSelections = 0;
            let configCount = 0;
            let configDetails = [];
            let totalVersions = 0;
            
            tableSelections.forEach((selections, tableId) => {
                if (selections.size > 0) {
                    hasSelections = true;
                    totalSelections += selections.size;
                    configCount++;
                    
                    // Get version count from this table's JSON if available
                    const json = consolidatedJsons.get(tableId);
                    if (json && json.configurations && json.configurations.length > 0) {
                        const versionCount = json.configurations[0].cpeMatch.length;
                        configDetails.push(`${selections.size} Criteria, ${versionCount} versions`);
                        totalVersions += versionCount;
                    } else {
                        configDetails.push(`${selections.size} criteria`);
                        totalVersions += selections.size; // Assume 1 version per Criteria if no detailed data
                    }
                }
            });
            
            // Show/hide the Export All button container based on whether there are selections
            const container = document.getElementById('allConfigurationsContainer');
            const exportButton = document.getElementById('exportAllConfigurations');
            const configSummary = document.getElementById('configurationSummary');
            
            if (container && exportButton) {
                container.style.display = hasSelections ? 'block' : 'none';
                
                // Update the summary text with selection count and version information
                if (hasSelections && configSummary) {
                    const display = document.getElementById('allConfigurationsDisplay');
                    
                    // Format the config summary
                    const summaryText = `${configCount} config${configCount !== 1 ? 's' : ''} (${configDetails.join(', ')})`;
                    
                    // Update the summary text instead of changing the button text
                    configSummary.textContent = summaryText;
                    
                    // Keep button text simple - just show/hide state
                    exportButton.textContent = display && display.style.display !== 'none' ? 
                        'Hide All Configurations' : 'Show All Configurations';
                } else if (configSummary) {
                    configSummary.textContent = '';
                }
            }
        } catch(e) {
            console.error("Error updating export all button:", e);
        }
    }
    
    // Update the all configurations display
    function updateAllConfigurationsDisplay() {
        try {
            const display = document.getElementById('allConfigurationsDisplay');
            const content = document.getElementById('allConfigurationsContent');
            
            if (display && content && display.style.display !== 'none') {
                // Create master JSON with configurations from all tables
                const masterJson = generateAllConfigurationsJson();
                
                if (!masterJson || !masterJson.configurations || masterJson.configurations.length === 0) {
                    content.textContent = 'No CPEs selected in any table. Please select at least one CPE row.';
                } else {
                    content.textContent = JSON.stringify(masterJson, null, 2);
                }
            }
        } catch(e) {
            console.error("Error updating all configurations display:", e);
        }
    }
    
    function generateAllConfigurationsJson() {
        try {
            // Create master JSON with all configurations
            const masterJson = {
                "configurations": []
            };
            
            // Add each table's configuration as a separate node in the configurations array
            consolidatedJsons.forEach((json, tableId) => {
                if (json && json.configurations && json.configurations.length > 0) {
                    // Each configuration from a table should retain its generatedFromSource
                    json.configurations.forEach(config => {
                        // Make sure we're including the generatedFromSource in each configuration
                        if (config.generatedFromSource) {
                            // It's already at the right level
                            masterJson.configurations.push(config);
                        } else {
                            // If it's missing (shouldn't happen with our code), add empty placeholder
                            config.generatedFromSource = {
                                "dataSource": "Unknown",
                                "sourceId": "Unknown",
                                "sourceRole": "Unknown"
                            };
                            masterJson.configurations.push(config);
                        }
                    });
                }
            });
            
            return masterJson;
        } catch(e) {
            console.error("Error generating all configurations JSON:", e);
            return { "configurations": [] };
        }
    }
    
    function createCpeMatchObject(cpeBase) {
        try {
            // Create a cpeMatch object for the given CPE base string
            const cpeMatch = {
                "criteria": cpeBase,
                "matchCriteriaId": "generated_" + Math.random().toString(36).substr(2, 9),
                "vulnerable": true
            };
            
            return cpeMatch;
        } catch(e) {
            console.error("Error creating CPE match object:", e);
            return {
                "criteria": "error_creating_cpe_match",
                "matchCriteriaId": "error_" + Date.now(),
                "vulnerable": true
            };
        }
    }

    // Process raw platform data to generate cpeMatch objects with version information
    function processVersionDataToCpeMatches(cpeBase, rawVersionData) {
        try {
            // Array to hold all generated cpeMatch objects
            const cpeMatches = [];
            
            // If no version data provided or no versions array, return a basic cpeMatch object
            if (!rawVersionData || !Array.isArray(rawVersionData.versions) || rawVersionData.versions.length === 0) {
                const basicMatch = createCpeMatchObject(cpeBase);
                return [basicMatch];
            }
            
            // Process each version entry in the versions array
            for (const versionInfo of rawVersionData.versions) {
                // Skip if there's no version information at all
                if (!versionInfo) continue;
                
                // Create a new cpeMatch object for this version
                const cpeMatch = {
                    "criteria": cpeBase,
                    "matchCriteriaId": "generated_" + Math.random().toString(36).substr(2, 9),
                    "vulnerable": versionInfo.status !== 'unaffected' // Set vulnerable based on status
                };
                
                // Handle different version patterns
                if (versionInfo.hasOwnProperty('lessThan')) {
                    // Version range with start (inclusive) and end (exclusive)
                    if (versionInfo.version) {
                        // Remove the "version 0" special handling - all versions should be treated the same
                        cpeMatch.versionStartIncluding = versionInfo.version;
                    }
                    if (versionInfo.lessThan) {
                        cpeMatch.versionEndExcluding = versionInfo.lessThan;
                    }
                    cpeMatches.push(cpeMatch);
                } 
                else if (versionInfo.hasOwnProperty('lessThanOrEqual')) {
                    // Version range with start (inclusive) and end (inclusive)
                    if (versionInfo.version) {
                        // Remove the "version 0" special handling - all versions should be treated the same
                        cpeMatch.versionStartIncluding = versionInfo.version;
                    }
                    if (versionInfo.lessThanOrEqual) {
                        cpeMatch.versionEndIncluding = versionInfo.lessThanOrEqual;
                    }
                    cpeMatches.push(cpeMatch);
                }
                // Handle greater than ranges (if present)
                else if (versionInfo.hasOwnProperty('greaterThan')) {
                    if (versionInfo.greaterThan) {
                        cpeMatch.versionStartExcluding = versionInfo.greaterThan;
                    }
                    if (versionInfo.version && versionInfo.version !== '*') {
                        cpeMatch.versionEndIncluding = versionInfo.version;
                    }
                    cpeMatches.push(cpeMatch);
                }
                // Handle greater than or equal ranges (if present)
                else if (versionInfo.hasOwnProperty('greaterThanOrEqual')) {
                    if (versionInfo.greaterThanOrEqual) {
                        cpeMatch.versionStartIncluding = versionInfo.greaterThanOrEqual;
                    }
                    if (versionInfo.version && versionInfo.version !== '*') {
                        cpeMatch.versionEndIncluding = versionInfo.version;
                    }
                    cpeMatches.push(cpeMatch);
                }
                // Handle single version - the most common case
                else if (versionInfo.hasOwnProperty('version')) {
                    // Split the CPE to update the version component (the 6th component, index 5)
                    const cpeParts = cpeBase.split(':');
                    if (cpeParts.length >= 6) {
                        // Replace the version part (at index 5)
                        cpeParts[5] = versionInfo.version;
                        // Rebuild the CPE string with updated version
                        cpeMatch.criteria = cpeParts.join(':');
                    }
                    cpeMatches.push(cpeMatch);
                }
            }
            
            // If no valid cpeMatch objects were created, return a basic one
            if (cpeMatches.length === 0) {
                const basicMatch = createCpeMatchObject(cpeBase);
                return [basicMatch];
            }
            
            return cpeMatches;
        } catch (e) {
            console.error("Error processing version data:", e);
            // Return a basic cpeMatch object in case of error
            const errorMatch = createCpeMatchObject(cpeBase);
            return [errorMatch];
        }
    }

    // Add this function to track completion status
    function updateCompletionTracker() {
        try {
            const tables = document.querySelectorAll('table[id^="rowDataTable_"]');
            let completedCount = 0;
            const totalCount = tables.length;
            
            // Count how many tables are collapsed (completed)
            tables.forEach(table => {
                if (table.classList.contains('d-none')) {
                    completedCount++;
                }
            });
            
            // Calculate percentage
            const percentage = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;
            
            // Update the progress bar
            const progressBar = document.getElementById('completionProgressBar');
            const completedRowsCount = document.getElementById('completedRowsCount');
            const totalRowsCount = document.getElementById('totalRowsCount');
            
            if (progressBar && completedRowsCount && totalRowsCount) {
                progressBar.style.width = `${percentage}%`;
                progressBar.textContent = `${percentage}%`;
                progressBar.setAttribute('aria-valuenow', percentage);
                
                // Change format to succinct fraction followed by "rows"
                completedRowsCount.textContent = `${completedCount}/${totalCount} rows`;
                // Remove the separate total count display since it's now in the fraction
                totalRowsCount.textContent = ''; // or just hide this element with display:none
            }
        } catch(e) {
            console.error('Error updating completion tracker:', e);
        }
    }
    
    // Maintain JSON display state across row toggle operations
    function preserveJsonDisplayState(tableIndex) {
        const tableId = `matchesTable_${tableIndex}`;
        const jsonContainer = document.querySelector(`.consolidated-json-container[data-index="${tableIndex}"]`);
        const display = document.getElementById(`consolidatedJsonDisplay_${tableId}`);
        const showButton = document.getElementById(`showConsolidatedJson_${tableId}`);
        
        if (!jsonContainer || !display || !showButton) return;
        
        // Store current state
        const isDisplayVisible = display.style.display !== 'none';
        const selectedRows = tableSelections.get(tableId);
        const selectionCount = selectedRows ? selectedRows.size : 0;
        
        // Get json and detailed statistics
        const json = consolidatedJsons.get(tableId);
        let statsStr = `${selectionCount} selected`;
        
        // Extract detailed statistics if available
        if (json && json.configurations && json.configurations.length > 0) {
            if (json.configurations[0].matchStats) {
                const stats = json.configurations[0].matchStats;
                statsStr = `${stats.selectedCriteria || stats.selectedCPEs} Criteria, ${stats.totalMatches} versions (${stats.exactMatches} exact, ${stats.rangeMatches} ranges)`;
            } else {
                // Fall back to basic statistics if detailed stats aren't available
                let versionCount = selectionCount;
                if (json.configurations[0].versionStats) {
                    versionCount = json.configurations[0].versionStats.totalVersions;
                } else if (json.configurations[0].cpeMatch) {
                    versionCount = json.configurations[0].cpeMatch.length;
                } else if (json.configurations[0].nodes) {
                    versionCount = getTotalCPEMatches(json.configurations[0]);
                }
                statsStr = `${selectionCount} Criteria, ${versionCount} versions`;
            }
        }
        
        // Ensure the button text and state matches the display visibility
        if (isDisplayVisible) {
            showButton.textContent = `Hide Consolidated JSON (${statsStr})`;
            showButton.classList.remove('btn-primary');
            showButton.classList.add('btn-success');
            
            // Also ensure the JSON content is updated
            updateJsonDisplayIfVisible(tableId);
        } else {
            showButton.textContent = `Show Consolidated JSON (${statsStr})`;
            showButton.classList.remove('btn-success');
            showButton.classList.add('btn-primary');
        }
        
        // Ensure proper container positioning
        const collapseButton = document.getElementById(`collapseRowButton_${tableIndex}`);
        if (collapseButton) {
            const buttonParent = collapseButton.parentNode;
            buttonParent.parentNode.insertBefore(jsonContainer, buttonParent.nextSibling);
        }
    }

    function getTotalCPEMatches(config) {
        let count = 0;
        if (config.nodes) {
            for (const node of config.nodes) {
                if (node.cpeMatch) {
                    count += node.cpeMatch.length;
                }
            }
        } else if (config.cpeMatch) {
            count = config.cpeMatch.length;
        }
        return count;
    }

    function processBasicVersionData(selectedRows, rawPlatformData, json) {
        let totalVersions = 0;
        
        // Add cpeMatch objects for each selected CPE, processing version information
        selectedRows.forEach(cpeBase => {
            // If we have raw platform data, process each version into cpeMatch objects
            if (rawPlatformData) {
                const cpeMatches = processVersionDataToCpeMatches(cpeBase, rawPlatformData);
                
                // Track version statistics
                cpeMatches.forEach(match => {
                    json.configurations[0].cpeMatch.push(match);
                    totalVersions++;
                });
            } else {
                // No version data, just use the basic CPE
                const basicMatch = createCpeMatchObject(cpeBase);
                json.configurations[0].cpeMatch.push(basicMatch);
                totalVersions++;
            }
        });
        
        // Store version statistics in the JSON for display
        json.configurations[0].versionStats = {
            totalVersions: totalVersions,
            selectedCriteria: selectedRows.size  // Changed from selectedCPEs to selectedCriteria
        };
    }
    </script>
    
    <!-- Tool Info Header -->
    <div class="header" style="margin-left: 10px;">
        <h1>NVD Analysis Intelligence Tool <small>Hashmire/Analysis_Tools version: {{VERSION_PLACEHOLDER}}</small></h1>
    </div>
    
    <!-- Tab links -->
    <div class="tab">
        <button class="tablinks" onclick="openCity(event, 'cveListCPESuggester')">CVE List CPE Suggester</button>
        <button class="tablinks" onclick="openCity(event, 'vdbIntelDashboard')">VDB Intel Dashboard</button>
    </div>
    
    <h3 style="margin-bottom: 0px; margin-left: 10px;"><b>CVE-2024-21389 results</b></h3>
    <hr style="margin: 10px; border: 1px solid;">
    
    <!-- CVE List CPE Suggester -->
    <div id="cveListCPESuggester" class="tabcontent" style="display: block; border-left: 0px;">
        <h3>CVE List CPE Suggester</h3>
        <table border="1" class="dataframe table table-stripped">
  <thead>
    <tr style="text-align: right;">
      <th style="min-width: 20%;">rowDataHTML</th>
      <th style="min-width: 80%;">cpeQueryHTML</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><div class="mb-3 d-flex gap-2" id="buttonContainer_0"><button id="collapseRowButton_0" class="btn btn-secondary" onclick="toggleRowCollapse(0)">Collapse Row (Mark Complete)</button></div><table id="rowDataTable_0" class="table table-hover">                <tr>                    <td>Data Source</td>                    <td>CVEAPI</td>                </tr>                                <tr>                    <td>Source ID</td>                    <td><span title="Contact Email: secure@microsoft.com &#013;Source Identifiers: secure@microsoft.com, f38d906d-7342-40ea-92c1-6c4a2c6478c8">Microsoft Corporation</span></td>                </tr>                                <tr>                    <td>Source Role</td>                    <td>CNA</td>                </tr>                                <tr>                    <td>Platform Format Type</td>                    <td>cveAffectsVersionRange</td>                </tr>                                    <tr>                        <td>Vendor Value</td>                        <td>Microsoft</td>                    </tr>                                        <tr>                        <td>Product Value</td>                        <td>Microsoft Dynamics 365 (on-premises) version 9.1</td>                    </tr>                                        <tr>                        <td>Platforms</td>                        <td>['Unknown']</td>                    </tr>                                    <tr>                    <td>Raw Platform Data</td>                    <td><details><summary>Review rawPlatformData</summary><code>{'vendor': 'Microsoft', 'product': 'Microsoft Dynamics 365 (on-premises) version 9.1', 'platforms': ['Unknown'], 'versions': [{'version': '9.0', 'lessThan': '9.1.25.17', 'versionType': 'custom', 'status': 'affected'}]}</code></details></td>                </tr>                </table></td>
      <td><div class="cpe-query-container" data-raw-platform="{&quot;vendor&quot;: &quot;Microsoft&quot;, &quot;product&quot;: &quot;Microsoft Dynamics 365 (on-premises) version 9.1&quot;, &quot;platforms&quot;: [&quot;Unknown&quot;], &quot;versions&quot;: [{&quot;version&quot;: &quot;9.0&quot;, &quot;lessThan&quot;: &quot;9.1.25.17&quot;, &quot;versionType&quot;: &quot;custom&quot;, &quot;status&quot;: &quot;affected&quot;}]}">    <table id="matchesTable_0" class="table table-hover matchesTable">    <thead>      <tr>        <th style="width: 50%">CPE Base String</th>        <th style="width: 50%">Match Details</th>      </tr>    </thead>    <tbody>            <tr id="row_cpe_2_3_a_microsoft_visual_foxpro_*_*_*_*_*_*_*_*" class="cpe-row" data-cpe-base="cpe:2.3:a:microsoft:visual_foxpro:*:*:*:*:*:*:*:*">            <td class="text-break">cpe:2.3:a:microsoft:visual_foxpro:*:*:*:*:*:*:*:*</td>            <td>                <div class="d-flex flex-wrap gap-1 align-items-center">                    <span class="badge rounded-pill bg-secondary" title="searchSourcevendor:  cpe:2.3:*:microsoft:*:*:*:*:*:*:*:*:*&#10;">Relevant Match String Searches: 1</span>                    <span class="badge rounded-pill bg-success" title="version: cpe:2.3:a:microsoft:visual_foxpro:9.0:sp1:*:*:*:*:*:*&#10;version: cpe:2.3:a:microsoft:visual_foxpro:9.0:sp2:*:*:*:*:*:*">Version Matches Identified: 2</span>                    <div class="badge bg-primary d-inline-flex align-items-center">                        Total CPE Names: 5                        <span class="badge bg-info ms-1">Final: 5</span>                        <span class="badge bg-warning ms-1">Deprecated: 0</span>                    </div>                </div>            </td>        </tr>                <tr id="row_cpe_2_3_a_microsoft_windows_sysmon_*_*_*_*_*_*_*_*" class="cpe-row" data-cpe-base="cpe:2.3:a:microsoft:windows_sysmon:*:*:*:*:*:*:*:*">            <td class="text-break">cpe:2.3:a:microsoft:windows_sysmon:*:*:*:*:*:*:*:*</td>            <td>                <div class="d-flex flex-wrap gap-1 align-items-center">                    <span class="badge rounded-pill bg-secondary" title="searchSourcevendor:  cpe:2.3:*:microsoft:*:*:*:*:*:*:*:*:*&#10;">Relevant Match String Searches: 1</span>                    <span class="badge rounded-pill bg-success" title="version: cpe:2.3:a:microsoft:windows_sysmon:9.0:*:*:*:*:*:*:*">Version Matches Identified: 1</span>                    <div class="badge bg-primary d-inline-flex align-items-center">                        Total CPE Names: 52                        <span class="badge bg-info ms-1">Final: 52</span>                        <span class="badge bg-warning ms-1">Deprecated: 0</span>                    </div>                </div>            </td>        </tr>                <tr id="row_cpe_2_3_a_microsoft_directx_*_*_*_*_*_*_*_*" class="cpe-row" data-cpe-base="cpe:2.3:a:microsoft:directx:*:*:*:*:*:*:*:*">            <td class="text-break">cpe:2.3:a:microsoft:directx:*:*:*:*:*:*:*:*</td>            <td>                <div class="d-flex flex-wrap gap-1 align-items-center">                    <span class="badge rounded-pill bg-secondary" title="searchSourcevendor:  cpe:2.3:*:microsoft:*:*:*:*:*:*:*:*:*&#10;">Relevant Match String Searches: 1</span>                    <span class="badge rounded-pill bg-success" title="version: cpe:2.3:a:microsoft:directx:9.0:*:*:*:*:*:*:*">Version Matches Identified: 1</span>                    <div class="badge bg-primary d-inline-flex align-items-center">                        Total CPE Names: 20                        <span class="badge bg-info ms-1">Final: 20</span>                        <span class="badge bg-warning ms-1">Deprecated: 0</span>                    </div>                </div>            </td>        </tr>                <tr id="row_cpe_2_3_a_microsoft_works_*_*_*_*_*_*_*_*" class="cpe-row" data-cpe-base="cpe:2.3:a:microsoft:works:*:*:*:*:*:*:*:*">            <td class="text-break">cpe:2.3:a:microsoft:works:*:*:*:*:*:*:*:*</td>            <td>                <div class="d-flex flex-wrap gap-1 align-items-center">                    <span class="badge rounded-pill bg-secondary" title="searchSourcevendor:  cpe:2.3:*:microsoft:*:*:*:*:*:*:*:*:*&#10;">Relevant Match String Searches: 1</span>                    <span class="badge rounded-pill bg-success" title="version: cpe:2.3:a:microsoft:works:9.0:*:*:*:*:*:*:*">Version Matches Identified: 1</span>                    <div class="badge bg-primary d-inline-flex align-items-center">                        Total CPE Names: 20                        <span class="badge bg-info ms-1">Final: 19</span>                        <span class="badge bg-warning ms-1">Deprecated: 1</span>                    </div>                </div>            </td>        </tr>                <tr id="row_cpe_2_3_a_microsoft_dynamics_365_*_*_*_*_on-premises_*_*_*" class="cpe-row" data-cpe-base="cpe:2.3:a:microsoft:dynamics_365:*:*:*:*:on-premises:*:*:*">            <td class="text-break">cpe:2.3:a:microsoft:dynamics_365:*:*:*:*:on-premises:*:*:*</td>            <td>                <div class="d-flex flex-wrap gap-1 align-items-center">                    <span class="badge rounded-pill bg-secondary" title="searchSourcevendor:  cpe:2.3:*:microsoft:*:*:*:*:*:*:*:*:*&#10;">Relevant Match String Searches: 1</span>                    <span class="badge rounded-pill bg-success" title="version: cpe:2.3:a:microsoft:dynamics_365:9.0:*:*:*:on-premises:*:*:*">Version Matches Identified: 1</span>                    <div class="badge bg-primary d-inline-flex align-items-center">                        Total CPE Names: 18                        <span class="badge bg-info ms-1">Final: 18</span>                        <span class="badge bg-warning ms-1">Deprecated: 0</span>                    </div>                </div>            </td>        </tr>                <tr id="row_cpe_2_3_a_microsoft_dynamics_365_*_*_*_*_*_*_*_*" class="cpe-row" data-cpe-base="cpe:2.3:a:microsoft:dynamics_365:*:*:*:*:*:*:*:*">            <td class="text-break">cpe:2.3:a:microsoft:dynamics_365:*:*:*:*:*:*:*:*</td>            <td>                <div class="d-flex flex-wrap gap-1 align-items-center">                    <span class="badge rounded-pill bg-secondary" title="searchSourcevendor:  cpe:2.3:*:microsoft:*:*:*:*:*:*:*:*:*&#10;">Relevant Match String Searches: 1</span>                    <span class="badge rounded-pill bg-success" title="version: cpe:2.3:a:microsoft:dynamics_365:9.0:*:*:*:*:*:*:*">Version Matches Identified: 1</span>                    <div class="badge bg-primary d-inline-flex align-items-center">                        Total CPE Names: 11                        <span class="badge bg-info ms-1">Final: 11</span>                        <span class="badge bg-warning ms-1">Deprecated: 0</span>                    </div>                </div>            </td>        </tr>                <tr id="row_cpe_2_3_a_microsoft_azure_service_fabric_*_*_*_*_*_*_*_*" class="cpe-row" data-cpe-base="cpe:2.3:a:microsoft:azure_service_fabric:*:*:*:*:*:*:*:*">            <td class="text-break">cpe:2.3:a:microsoft:azure_service_fabric:*:*:*:*:*:*:*:*</td>            <td>                <div class="d-flex flex-wrap gap-1 align-items-center">                    <span class="badge rounded-pill bg-secondary" title="searchSourcevendor:  cpe:2.3:*:microsoft:*:*:*:*:*:*:*:*:*&#10;">Relevant Match String Searches: 1</span>                    <span class="badge rounded-pill bg-success" title="version: cpe:2.3:a:microsoft:azure_service_fabric:9.0:-:*:*:*:*:*:*">Version Matches Identified: 1</span>                    <div class="badge bg-primary d-inline-flex align-items-center">                        Total CPE Names: 6                        <span class="badge bg-info ms-1">Final: 6</span>                        <span class="badge bg-warning ms-1">Deprecated: 0</span>                    </div>                </div>            </td>        </tr>                <tr id="row_cpe_2_3_a_microsoft_dynamics_365_*_*_*_*_customer_engagement_*_*_*" class="cpe-row" data-cpe-base="cpe:2.3:a:microsoft:dynamics_365:*:*:*:*:customer_engagement:*:*:*">            <td class="text-break">cpe:2.3:a:microsoft:dynamics_365:*:*:*:*:customer_engagement:*:*:*</td>            <td>                <div class="d-flex flex-wrap gap-1 align-items-center">                    <span class="badge rounded-pill bg-secondary" title="searchSourcevendor:  cpe:2.3:*:microsoft:*:*:*:*:*:*:*:*:*&#10;">Relevant Match String Searches: 1</span>                    <span class="badge rounded-pill bg-success" title="version: cpe:2.3:a:microsoft:dynamics_365:9.0:*:*:*:customer_engagement:*:*:*">Version Matches Identified: 1</span>                    <div class="badge bg-primary d-inline-flex align-items-center">                        Total CPE Names: 2                        <span class="badge bg-info ms-1">Final: 2</span>                        <span class="badge bg-warning ms-1">Deprecated: 0</span>                    </div>                </div>            </td>        </tr>                <tr id="row_cpe_2_3_a_microsoft_snip_\&_sketch_*_*_*_*_*_*_*_*" class="cpe-row" data-cpe-base="cpe:2.3:a:microsoft:snip_\&_sketch:*:*:*:*:*:*:*:*">            <td class="text-break">cpe:2.3:a:microsoft:snip_\&_sketch:*:*:*:*:*:*:*:*</td>            <td>                <div class="d-flex flex-wrap gap-1 align-items-center">                    <span class="badge rounded-pill bg-secondary" title="searchSourcevendor:  cpe:2.3:*:microsoft:*:*:*:*:*:*:*:*:*&#10;">Relevant Match String Searches: 1</span>                    <span class="badge rounded-pill bg-success" title="version: cpe:2.3:a:microsoft:snip_\&_sketch:9.0:*:*:*:*:*:*:*">Version Matches Identified: 1</span>                    <div class="badge bg-primary d-inline-flex align-items-center">                        Total CPE Names: 2                        <span class="badge bg-info ms-1">Final: 2</span>                        <span class="badge bg-warning ms-1">Deprecated: 0</span>                    </div>                </div>            </td>        </tr>                <tr id="row_cpe_2_3_a_microsoft_live_messenger_*_*_*_*_*_*_*_*" class="cpe-row" data-cpe-base="cpe:2.3:a:microsoft:live_messenger:*:*:*:*:*:*:*:*">            <td class="text-break">cpe:2.3:a:microsoft:live_messenger:*:*:*:*:*:*:*:*</td>            <td>                <div class="d-flex flex-wrap gap-1 align-items-center">                    <span class="badge rounded-pill bg-secondary" title="searchSourcevendor:  cpe:2.3:*:microsoft:*:*:*:*:*:*:*:*:*&#10;">Relevant Match String Searches: 1</span>                    <span class="badge rounded-pill bg-success" title="version: cpe:2.3:a:microsoft:live_messenger:9.0:*:*:*:*:*:*:*">Version Matches Identified: 1</span>                    <div class="badge bg-primary d-inline-flex align-items-center">                        Total CPE Names: 1                        <span class="badge bg-info ms-1">Final: 1</span>                        <span class="badge bg-warning ms-1">Deprecated: 0</span>                    </div>                </div>            </td>        </tr>            </tbody>    </table>    </div></td>
    </tr>
    <tr>
      <td><div class="mb-3 d-flex gap-2" id="buttonContainer_1"><button id="collapseRowButton_1" class="btn btn-secondary" onclick="toggleRowCollapse(1)">Collapse Row (Mark Complete)</button></div><table id="rowDataTable_1" class="table table-hover">                <tr>                    <td>Data Source</td>                    <td>NVDAPI</td>                </tr>                                <tr>                    <td>Source ID</td>                    <td><span title="Contact Email: nvd@nist.gov &#013;Source Identifiers: nvd@nist.gov">NIST</span></td>                </tr>                                <tr>                    <td>Source Role</td>                    <td>NVD</td>                </tr>                                <tr>                    <td>Platform Format Type</td>                    <td>nvdConfiguration <span title="CPE Array Included">  &#10003;</span></td>                </tr>                                    <tr>                        <td>Vendor Value</td>                        <td>microsoft</td>                    </tr>                                        <tr>                        <td>Product Value</td>                        <td>dynamics_365</td>                    </tr>                                    <tr>                    <td>Raw Platform Data</td>                    <td><details><summary>Review rawPlatformData</summary><code>{'vendor': 'microsoft', 'product': 'dynamics_365', 'hasEmbeddedConfig': True, 'configStats': {'totalCPEs': 1}}</code></details></td>                </tr>                </table></td>
      <td><div class="cpe-query-container" data-raw-config="{&quot;nodes&quot;: [{&quot;operator&quot;: &quot;OR&quot;, &quot;negate&quot;: false, &quot;cpeMatch&quot;: [{&quot;vulnerable&quot;: true, &quot;criteria&quot;: &quot;cpe:2.3:a:microsoft:dynamics_365:*:*:*:*:on-premises:*:*:*&quot;, &quot;versionStartIncluding&quot;: &quot;9.1&quot;, &quot;versionEndExcluding&quot;: &quot;9.1.25.17&quot;, &quot;matchCriteriaId&quot;: &quot;B5249C78-D15C-446E-8853-A0B6C1CA7834&quot;}]}]}" data-raw-platform="{&quot;vendor&quot;: &quot;microsoft&quot;, &quot;product&quot;: &quot;dynamics_365&quot;, &quot;hasEmbeddedConfig&quot;: true, &quot;configStats&quot;: {&quot;totalCPEs&quot;: 1}}">    <table id="matchesTable_1" class="table table-hover matchesTable">    <thead>      <tr>        <th style="width: 50%">CPE Base String</th>        <th style="width: 50%">Match Details</th>      </tr>    </thead>    <tbody>        </tbody>    </table>    </div></td>
    </tr>
  </tbody>
</table>
    </div>
    
        <!-- VDB Intel Dashboard -->
        <div id="vdbIntelDashboard" class="tabcontent" style="border-left: 0px;">
            <h3>VDB Intel Dashboard</h3>
            <table class="table table-hover" id="supportedSourceTable"><tr><th>Name & Link</th><th>CVSS v3.x</th><th>CWE</th><th>Notes/Context</th><th>Response Code</th></tr><tr id="IBM-Xforce"><td><a href="https://exchange.xforce.ibmcloud.com/vulnerabilities/CVE-2024-21389" target="_blank">IBM Xforce</a></td><td> - </td><td> - </td><td> - </td><td>Response Data:  200</td></tr><tr id="Teneble-CVE"><td><a href="https://www.tenable.com/cve/CVE-2024-21389" target="_blank">Teneble CVE</a></td><td> - </td><td> - </td><td> - </td><td>Response Data:  200</td></tr><tr id="Microsoft-MSRC"><td><a href="https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-21389" target="_blank">Microsoft MSRC</a></td><td> - </td><td> - </td><td> - </td><td>Response Data:  200</td></tr><tr id="RedHat-Security-API" class="danger"><td><a href="https://access.redhat.com/hydra/rest/securitydata/CVE-2024-21389" target="_blank">RedHat Security API</a></td><td> - </td><td> - </td><td> - </td><td>Response Data:  404</td></tr><tr id="Amazon-CVE" class="danger"><td><a href="https://alas.aws.amazon.com/cve/html/CVE-2024-21389" target="_blank">Amazon CVE</a></td><td> - </td><td> - </td><td> - </td><td>Response Data:  403</td></tr><tr id="SUSE-CVE" class="danger"><td><a href="https://www.suse.com/security/cve/CVE-2024-21389" target="_blank">SUSE CVE</a></td><td> - </td><td> - </td><td> - </td><td>Response Data:  404</td></tr></table>
        </div>
        
    <script>
        function openCity(evt, cityName) {
            // Declare all variables
            var i, tabcontent, tablinks;

            // Get all elements with class="tabcontent" and hide them
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }

            // Get all elements with class="tablinks" and remove the class "active"
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }

            // Show the current tab, and add an "active" class to the button that opened the tab
            document.getElementById(cityName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script>
    </body></html>