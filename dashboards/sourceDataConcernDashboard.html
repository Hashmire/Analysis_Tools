<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Source Data Concern Dashboard - JSON-Based</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 0;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 10px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .file-selector {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .file-selector h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .file-input-container {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .file-input {
            flex: 1;
            min-width: 300px;
        }
        
        .file-input input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 2px dashed #667eea;
            border-radius: 5px;
            background: #f8f9fa;
            cursor: pointer;
        }
        
        .load-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s ease;
        }
        
        .load-btn:hover {
            background: #5a6fd8;
        }
        
        .load-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .stat-label {
            font-size: 1.1rem;
            color: #666;
        }
        
        .section {
            background: white;
            margin-bottom: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .section-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .section-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 5px;
        }
        
        .section-subtitle {
            color: #666;
            font-size: 0.9rem;
        }
        
        .section-content {
            padding: 20px;
        }
        
        .nav-tabs {
            display: flex;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 20px;
        }
        
        .nav-tab {
            background: none;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 1rem;
            color: #666;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }
        
        .nav-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .nav-tab:hover {
            background: #f8f9fa;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .concern-list {
            list-style: none;
        }
        
        .concern-item {
            background: #f8f9fa;
            margin-bottom: 15px;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .concern-item h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .concern-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
        }
        
        .concern-stat {
            background: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .concern-stat strong {
            color: #667eea;
        }
        
        .source-list {
            list-style: none;
        }
        
        .source-item {
            background: #f8f9fa;
            margin-bottom: 15px;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }
        
        .source-item h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .source-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .source-stat {
            background: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .source-stat strong {
            color: #28a745;
        }
        
        .top-concerns {
            margin-bottom: 15px;
        }
        
        .top-concern {
            display: inline-block;
            background: #e9ecef;
            padding: 4px 8px;
            margin: 2px;
            border-radius: 4px;
            font-size: 0.8rem;
        }
        
        .cve-list {
            margin-top: 10px;
        }
        
        .cve-tag {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 8px;
            margin: 2px;
            border-radius: 4px;
            font-size: 0.8rem;
            text-decoration: none;
        }
        
        .cve-tag:hover {
            background: #5a6fd8;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #f5c6cb;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #c3e6cb;
            margin-bottom: 20px;
        }
        
        .metadata-info {
            background: #e2e3e5;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .metadata-info h4 {
            margin-bottom: 10px;
            color: #333;
        }
        
        .metadata-item {
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .metadata-item strong {
            color: #667eea;
        }
        
        details {
            margin-top: 10px;
        }
        
        summary {
            cursor: pointer;
            font-weight: bold;
            padding: 5px 0;
            color: #667eea;
        }
        
        summary:hover {
            color: #5a6fd8;
        }
        
        .concern-detail {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 3px solid #ffc107;
        }
        
        .concern-detail h5 {
            color: #333;
            margin-bottom: 8px;
        }
        
        .concern-detail p {
            margin: 5px 0;
            font-size: 0.9rem;
        }
        
        .concern-detail .concern-category {
            font-weight: bold;
            color: #667eea;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            
            .concern-stats,
            .source-stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .file-input-container {
                flex-direction: column;
            }
            
            .file-input {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Source Data Concern Dashboard</h1>
            <p>JSON-Based Analysis Tool for CVE Source Data Quality Review</p>
        </div>
        
        <!-- File Selector Section -->
        <div class="file-selector">
            <h3>Load Source Data Concern Report</h3>
            <div class="file-input-container">
                <div class="file-input">
                    <input type="file" id="jsonFileInput" accept=".json" />
                </div>
                <button class="load-btn" id="loadBtn" onclick="loadJsonFile()">Load Report</button>
            </div>
            <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                Select a sourceDataConcernReport.json file from any analysis run directory
            </p>
        </div>
        
        <!-- Metadata Section -->
        <div id="metadata-section" class="section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">Report Information</h2>
                <p class="section-subtitle">Processing run metadata and configuration</p>
            </div>
            <div class="section-content">
                <div id="metadata-content"></div>
            </div>
        </div>
        
        <!-- Statistics Section -->
        <div id="stats-section-container" class="section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">Overview Statistics</h2>
                <p class="section-subtitle">High-level metrics for source data quality</p>
            </div>
            <div class="section-content">
                <div id="stats-section" class="stats-grid">
                    <!-- Statistics will be populated here -->
                </div>
            </div>
        </div>
        
        <!-- Main Analysis Section -->
        <div id="analysis-section" class="section" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">Detailed Analysis</h2>
                <p class="section-subtitle">Source data concerns organized by type and source</p>
            </div>
            <div class="section-content">
                <div class="nav-tabs">
                    <button class="nav-tab active" onclick="showTab('concerns')">By Concern Type</button>
                    <button class="nav-tab" onclick="showTab('sources')">By Source</button>
                    <button class="nav-tab" onclick="showTab('cves')">By CVE</button>
                </div>
                
                <div id="concerns-tab" class="tab-content active">
                    <div id="concerns-list">
                        <div class="loading">No data loaded</div>
                    </div>
                </div>
                
                <div id="sources-tab" class="tab-content">
                    <div id="sources-list">
                        <div class="loading">No data loaded</div>
                    </div>
                </div>
                
                <div id="cves-tab" class="tab-content">
                    <div id="cves-list">
                        <div class="loading">No data loaded</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let dashboardData = null;
        
        // Concern type display names mapping
        const concernTypeNames = {
            'placeholderData': 'Placeholder Data',
            'versionTextPatterns': 'Version Text Patterns', 
            'versionComparators': 'Version Comparators',
            'versionGranularity': 'Version Granularity',
            'wildcardBranches': 'Wildcard Branches',
            'cpeArrayConcerns': 'CPE Array Concerns',
            'duplicateEntries': 'Duplicate Entries',
            'platformDataConcerns': 'Platform Data Concerns',
            'missingAffectedProducts': 'Missing Affected Products'
        };
        
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Hide all tab buttons
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }
        
        function loadJsonFile() {
            const fileInput = document.getElementById('jsonFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showError('Please select a JSON file to load.');
                return;
            }
            
            if (!file.name.endsWith('.json')) {
                showError('Please select a valid JSON file.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const jsonData = JSON.parse(e.target.result);
                    
                    // Validate the JSON structure
                    if (!jsonData.metadata || !jsonData.cve_data) {
                        showError('Invalid JSON structure. Expected sourceDataConcernReport.json format.');
                        return;
                    }
                    
                    dashboardData = jsonData;
                    processLoadedData();
                    showSuccess(`Successfully loaded report: ${file.name}`);
                    
                } catch (error) {
                    showError(`Failed to parse JSON file: ${error.message}`);
                }
            };
            
            reader.readAsText(file);
        }
        
        function processLoadedData() {
            if (!dashboardData) return;
            
            // Show all sections
            document.getElementById('metadata-section').style.display = 'block';
            document.getElementById('stats-section-container').style.display = 'block';
            document.getElementById('analysis-section').style.display = 'block';
            
            // Populate all sections
            populateMetadata();
            populateStats();
            populateConcerns();
            populateSources();
            populateCVEs();
        }
        
        function populateMetadata() {
            const metadata = dashboardData.metadata;
            const metadataContent = document.getElementById('metadata-content');
            
            const startTime = new Date(metadata.run_started_at).toLocaleString();
            const endTime = metadata.run_completed_at ? new Date(metadata.run_completed_at).toLocaleString() : 'In Progress';
            
            metadataContent.innerHTML = `
                <div class="metadata-info">
                    <h4>Processing Run Details</h4>
                    <div class="metadata-item"><strong>Status:</strong> ${metadata.status}</div>
                    <div class="metadata-item"><strong>Started:</strong> ${startTime}</div>
                    <div class="metadata-item"><strong>Completed:</strong> ${endTime}</div>
                    <div class="metadata-item"><strong>Scope:</strong> ${metadata.report_scope || 'Source Data Concerns'}</div>
                    <div class="metadata-item"><strong>CVEs Processed:</strong> ${metadata.total_cves_processed}</div>
                    <div class="metadata-item"><strong>Platform Entries:</strong> ${metadata.total_platform_entries}</div>
                    <div class="metadata-item"><strong>Entries with Concerns:</strong> ${metadata.entries_with_concerns}</div>
                </div>
            `;
        }
        
        function populateStats() {
            const metadata = dashboardData.metadata;
            const cveData = dashboardData.cve_data;
            
            // Calculate statistics
            const totalCVEs = metadata.total_cves_processed;
            const totalEntries = metadata.total_platform_entries;
            const entriesWithConcerns = metadata.entries_with_concerns;
            const totalConcernTypes = metadata.concern_type_counts.length;
            const totalConcerns = metadata.concern_type_counts.reduce((sum, item) => sum + item.count, 0);
            
            // Count unique sources
            const uniqueSources = new Set();
            cveData.forEach(cve => {
                cve.platform_entries.forEach(entry => {
                    uniqueSources.add(entry.source_id);
                });
            });
            
            const statsSection = document.getElementById('stats-section');
            statsSection.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalCVEs}</div>
                    <div class="stat-label">CVE Records</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${uniqueSources.size}</div>
                    <div class="stat-label">Unique Sources</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalEntries}</div>
                    <div class="stat-label">Platform Entries</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${entriesWithConcerns}</div>
                    <div class="stat-label">Entries with Concerns</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalConcerns}</div>
                    <div class="stat-label">Total Concerns</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${totalConcernTypes}</div>
                    <div class="stat-label">Concern Types</div>
                </div>
            `;
        }
        
        function populateConcerns() {
            const concernsList = document.getElementById('concerns-list');
            const concernData = {};
            
            // Aggregate concern data across all CVEs
            dashboardData.cve_data.forEach(cve => {
                cve.platform_entries.forEach(entry => {
                    if (entry.total_concerns > 0) {
                        entry.concerns_detail.forEach(concernDetail => {
                            const concernType = concernDetail.concern_type;
                            const displayName = concernTypeNames[concernType] || concernType;
                            
                            if (!concernData[displayName]) {
                                concernData[displayName] = {
                                    total_occurrences: 0,
                                    affected_sources: new Set(),
                                    affected_cves: new Set(),
                                    examples: []
                                };
                            }
                            
                            concernData[displayName].total_occurrences += concernDetail.concerns.length;
                            concernData[displayName].affected_sources.add(entry.source_id);
                            concernData[displayName].affected_cves.add(cve.cve_id);
                            
                            // Add examples
                            concernDetail.concerns.forEach(concern => {
                                concernData[displayName].examples.push({
                                    cve_id: cve.cve_id,
                                    source_id: entry.source_id,
                                    vendor: entry.vendor,
                                    product: entry.product,
                                    concern: concern
                                });
                            });
                        });
                    }
                });
            });
            
            // Sort by occurrence count
            const sortedConcerns = Object.entries(concernData)
                .sort((a, b) => b[1].total_occurrences - a[1].total_occurrences);
            
            if (sortedConcerns.length === 0) {
                concernsList.innerHTML = '<div class="loading">No concern data available.</div>';
                return;
            }
            
            const concernsHTML = sortedConcerns.map(([concernType, data]) => `
                <div class="concern-item">
                    <h4>${concernType}</h4>
                    <div class="concern-stats">
                        <div class="concern-stat">
                            <strong>${data.total_occurrences}</strong> occurrences
                        </div>
                        <div class="concern-stat">
                            <strong>${data.affected_sources.size}</strong> sources affected
                        </div>
                        <div class="concern-stat">
                            <strong>${data.affected_cves.size}</strong> CVEs affected
                        </div>
                    </div>
                    <details>
                        <summary>View examples (${Math.min(data.examples.length, 10)})</summary>
                        <div class="concern-details">
                            ${data.examples.slice(0, 10).map(example => `
                                <div class="concern-detail">
                                    <h5>${example.cve_id} - ${example.vendor}/${example.product}</h5>
                                    <p><span class="concern-category">${example.concern.category || 'General'}:</span> ${example.concern.concern || example.concern.issue || 'No details available'}</p>
                                    ${example.concern.issue ? `<p><strong>Issue:</strong> ${example.concern.issue}</p>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </details>
                </div>
            `).join('');
            
            concernsList.innerHTML = concernsHTML;
        }
        
        function populateSources() {
            const sourcesList = document.getElementById('sources-list');
            const sourceData = {};
            
            // Aggregate source data
            dashboardData.cve_data.forEach(cve => {
                cve.platform_entries.forEach(entry => {
                    if (!sourceData[entry.source_id]) {
                        sourceData[entry.source_id] = {
                            source_id: entry.source_id,
                            source_name: entry.source_name || entry.source_id, // Use human-readable name if available
                            total_concerns: 0,
                            cve_records: new Set(),
                            concern_breakdown: {},
                            entries: []
                        };
                    }
                    
                    const source = sourceData[entry.source_id];
                    source.total_concerns += entry.total_concerns;
                    source.cve_records.add(cve.cve_id);
                    source.entries.push({
                        cve_id: cve.cve_id,
                        vendor: entry.vendor,
                        product: entry.product,
                        table_index: entry.table_index,
                        concerns: entry.total_concerns,
                        concern_breakdown: entry.concern_breakdown
                    });
                    
                    // Merge concern breakdown
                    Object.entries(entry.concern_breakdown).forEach(([type, count]) => {
                        const displayName = concernTypeNames[type] || type;
                        source.concern_breakdown[displayName] = (source.concern_breakdown[displayName] || 0) + count;
                    });
                });
            });
            
            // Sort by total concerns
            const sortedSources = Object.entries(sourceData)
                .sort((a, b) => b[1].total_concerns - a[1].total_concerns);
            
            if (sortedSources.length === 0) {
                sourcesList.innerHTML = '<div class="loading">No source data available.</div>';
                return;
            }
            
            const sourcesHTML = sortedSources.map(([sourceId, data]) => {
                const topConcerns = Object.entries(data.concern_breakdown)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                return `
                    <div class="source-item">
                        <h4>${data.source_name}</h4>
                        <div class="source-stats">
                            <div class="source-stat">
                                <strong>${data.total_concerns}</strong> total concerns
                            </div>
                            <div class="source-stat">
                                <strong>${data.cve_records.size}</strong> CVE records
                            </div>
                            <div class="source-stat">
                                <strong>${data.entries.length}</strong> platform entries
                            </div>
                        </div>
                        <div class="top-concerns">
                            <strong>Top Concern Types:</strong>
                            ${topConcerns.map(([type, count]) => 
                                `<div class="top-concern">${type}: ${count}</div>`
                            ).join('')}
                        </div>
                        <details>
                            <summary>View platform entries (${data.entries.length})</summary>
                            <div class="cve-list">
                                ${data.entries.map(entry => `
                                    <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 5px;">
                                        <strong>${entry.cve_id}</strong> - ${entry.vendor}/${entry.product}
                                        <br><small>Table ${entry.table_index}, ${entry.concerns} concerns</small>
                                    </div>
                                `).join('')}
                            </div>
                        </details>
                    </div>
                `;
            }).join('');
            
            sourcesList.innerHTML = sourcesHTML;
        }
        
        function populateCVEs() {
            const cvesList = document.getElementById('cves-list');
            
            // Sort CVEs by number of platform entries with concerns
            const sortedCVEs = dashboardData.cve_data
                .map(cve => ({
                    ...cve,
                    entriesWithConcerns: cve.platform_entries.filter(entry => entry.total_concerns > 0).length,
                    totalConcerns: cve.platform_entries.reduce((sum, entry) => sum + entry.total_concerns, 0)
                }))
                .sort((a, b) => b.totalConcerns - a.totalConcerns);
            
            if (sortedCVEs.length === 0) {
                cvesList.innerHTML = '<div class="loading">No CVE data available.</div>';
                return;
            }
            
            const cvesHTML = sortedCVEs.map(cve => `
                <div class="source-item">
                    <h4>${cve.cve_id}</h4>
                    <div class="source-stats">
                        <div class="source-stat">
                            <strong>${cve.totalConcerns}</strong> total concerns
                        </div>
                        <div class="source-stat">
                            <strong>${cve.entriesWithConcerns}</strong> entries with concerns
                        </div>
                        <div class="source-stat">
                            <strong>${cve.platform_entries.length}</strong> total entries
                        </div>
                    </div>
                    <details>
                        <summary>View platform entries (${cve.platform_entries.length})</summary>
                        <div class="cve-list">
                            ${cve.platform_entries.map(entry => `
                                <div style="margin: 10px 0; padding: 10px; background: ${entry.total_concerns > 0 ? '#fff3cd' : 'white'}; border-radius: 5px; border-left: 3px solid ${entry.total_concerns > 0 ? '#ffc107' : '#28a745'};">
                                    <strong>${entry.vendor}/${entry.product}</strong> (Table ${entry.table_index})
                                    <br><small>Source: ${entry.source_id}</small>
                                    ${entry.total_concerns > 0 ? `<br><small style="color: #856404;">${entry.total_concerns} concerns: ${entry.concern_types.join(', ')}</small>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </details>
                </div>
            `).join('');
            
            cvesList.innerHTML = cvesHTML;
        }
        
        function showError(message) {
            // Remove existing alerts
            document.querySelectorAll('.error, .success').forEach(el => el.remove());
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            
            const fileSelector = document.querySelector('.file-selector');
            fileSelector.parentNode.insertBefore(errorDiv, fileSelector.nextSibling);
        }
        
        function showSuccess(message) {
            // Remove existing alerts
            document.querySelectorAll('.error, .success').forEach(el => el.remove());
            
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            
            const fileSelector = document.querySelector('.file-selector');
            fileSelector.parentNode.insertBefore(successDiv, fileSelector.nextSibling);
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Enable drag and drop for file input
            const fileInput = document.getElementById('jsonFileInput');
            const fileSelector = document.querySelector('.file-selector');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                fileSelector.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                fileSelector.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                fileSelector.addEventListener(eventName, unhighlight, false);
            });
            
            fileSelector.addEventListener('drop', handleDrop, false);
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            function highlight() {
                fileSelector.style.backgroundColor = '#e3f2fd';
            }
            
            function unhighlight() {
                fileSelector.style.backgroundColor = '';
            }
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    fileInput.files = files;
                    loadJsonFile();
                }
            }
        });
    </script>
</body>
</html>
